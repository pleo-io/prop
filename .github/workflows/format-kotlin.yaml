# THIS CODE WAS AUTOGENERATED. DO NOT MODIFY THIS FILE DIRECTLY
# THE SOURCE CODE LIVES IN A DIFFERENT REPOSITORY:
#   - centralized-templates
# FILE STEWARD: @pleo-io/devexp

name: Format Kotlin
on:
  push:
    branches-ignore:
    - main
    - master

concurrency:
  group: ci-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  format:
    name: Format Kotlin
    runs-on: ubuntu-latest
    steps:
    # Generate temporary token for allowing CI to run on the formatted files.
    - name: Generate temporary CI token
      id: get-admin-token
      uses: peter-murray/workflow-application-token-action@v2
      with:
        application_id: ${{ secrets.PLEO_GH_APP_TOKEN_SIGNER_APP_ID }}
        application_private_key: ${{ secrets.PLEO_GH_APP_TOKEN_SIGNER_PRIVATE_KEY }}

    # Checkout code with push privileges.
    - name: Checkout code
      uses: actions/checkout@v3.2.0
      with:
        token: ${{ steps.get-admin-token.outputs.token }}

    # Set up a JDK environment for building, testing and releasing.
    - name: Set up JDK 17.0.4
      uses: actions/setup-java@v3.9.0
      with:
        java-version: 17.0.4
        distribution: temurin

    # Allow caching Gradle executions to further speed up CI/CD steps invoking Gradle.
    - name: Setup Gradle
      uses: gradle/gradle-build-action@v2.3.3
      with:
        gradle-executable: ./gradlew
        gradle-version: wrapper
        cache-read-only: true

    # Format code via the formatkotlin Gradle task.
    - name: Format files
      run: |
        ./gradlew formatkotlin --stacktrace
      env:
        GRADLE_READ_KEY: ${{ secrets.GH_REGISTRY_GRADLE_TOKEN }}

    # Add and commit any formatted files.
    - name: Add formatted files
      uses: EndBug/add-and-commit@v9.1.1
      with:
        author_name: github-actions[bot]
        author_email: github-actions@pleo.io
        message: Format Kotlin
        commit: --no-verify
