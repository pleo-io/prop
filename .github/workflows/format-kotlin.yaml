# THIS CODE WAS AUTOGENERATED. DO NOT MODIFY THIS FILE DIRECTLY
# THE SOURCE CODE LIVES IN A DIFFERENT REPOSITORY:
#   - centralized-templates
# FILE STEWARD: @pleo-io/devx,@pleo-bot-auto-approver

name: Format Kotlin
on:
  push:
    branches-ignore:
      - main
      - master
      - "depencencies/**"
  pull_request:
    branches:
      - main
      - master

concurrency:
  group: ci-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  format:
    name: Format Kotlin
    runs-on: ubuntu-latest
    timeout-minutes: 10
    steps:
      # Generate temporary token for allowing CI to run on the formatted files.
      - name: Generate temporary CI token
        id: get-admin-token
        uses: peter-murray/workflow-application-token-action@v2
        with:
          application_id: ${{ secrets.PLEO_GH_APP_TOKEN_SIGNER_APP_ID }}
          application_private_key: ${{ secrets.PLEO_GH_APP_TOKEN_SIGNER_PRIVATE_KEY }}

      # Checkout code with push privileges.
      - name: Checkout code
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11 # v4.1.1
        with:
          token: ${{ steps.get-admin-token.outputs.token }}

      # Set up a JDK environment for building, testing and releasing.
      - name: Set up JDK 17
        uses: actions/setup-java@v3.13.0
        with:
          java-version: 17
          distribution: temurin

      # Allow caching Gradle executions to further speed up CI/CD steps invoking Gradle.
      - name: Setup Gradle
        uses: gradle/gradle-build-action@v2.10.0
        with:
          gradle-executable: ./gradlew
          gradle-version: wrapper
          cache-read-only: true

      # Format code via the formatkotlin Gradle task.
      - name: Format files
        run: |
          ./gradlew formatkotlin
        env:
          GRADLE_READ_KEY: ${{ secrets.GH_REGISTRY_GRADLE_TOKEN }}
          JOB_RUNR_REPO_PASSWORD: ${{ secrets.JOB_RUNR_REPO_PASSWORD }}

      # Add and commit any formatted files.
      - name: Add formatted files
        uses: EndBug/add-and-commit@v9.1.3
        with:
          author_name: github-actions[bot]
          author_email: github-actions@pleo.io
          message: Format Kotlin
          commit: --no-verify
