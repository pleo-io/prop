# THIS CODE WAS AUTOGENERATED. DO NOT MODIFY THIS FILE DIRECTLY
# THE SOURCE CODE LIVES IN A DIFFERENT REPOSITORY:
#   - centralized-templates
# FILE STEWARD: @pleo-io/devx

name: Assign Random CODEOWNERS

on:
  pull_request:
    types:
      - review_requested
      - ready_for_review
      - opened

concurrency:
  group: ci-${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  assign-codeowners:
    name: Assign CODEOWNERS
    timeout-minutes: 5
    if: github.event.pull_request.draft == false
    runs-on: ubuntu-latest

    steps:
      # Checkout the repository in order to detect and parse CODEOWNERS
      - name: Checkout code
        uses: actions/checkout@v3

      # Elevate token permissions to allow assigning people to PRs
      - name: Allow assigning reviewers
        id: get-assigning-token
        uses: peter-murray/workflow-application-token-action@v2
        with:
          application_id: ${{ secrets.PLEO_GH_APP_TOKEN_SIGNER_APP_ID }}
          application_private_key: ${{ secrets.PLEO_GH_APP_TOKEN_SIGNER_PRIVATE_KEY }}

      # Assign random CODEOWNERS unless reviewers have been assigned manually
      - name: Assign CODEOWNERS
        uses: pleo-io/assign-random-codeowners@v0.2.10
        with:
          reviewers-to-assign: 2
          assign-from-changed-files: true
          assign-individuals-from-teams: true
        env:
          GITHUB_TOKEN: ${{ steps.get-assigning-token.outputs.token }}
